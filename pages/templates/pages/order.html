<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pizza GO - order</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

</head>
<body style="background-color: bisque;">
  {% load static %}
  <nav class="navbar navbar-light" style="height: 90px; background-color: rgb(255, 255, 255);">
    <div class="container-fluid">
      <a class="navbar-brand mb-0 h1" href="/">
        <img src="{% static 'pages/image/posters/logo.png' %}" style="mix-blend-mode: multiply;">
        PIZZA GO!
      </a>
    </div>
  </nav>

  <div class="container">
    <table class="table">
      <thead>
        <tr>
          <th>SR No </th>
          <th>Item </th>
          <th>Description</th>
          <th>Qyt </th>
          <th>Price</th>
        </tr>
      </thead>

      <tbody id="table_body">
  


      </tbody>

    </table>
    Address:<br>
    <textarea name="address" id="address"> </textarea>
    <center>
      <button type="submit" class="btn btn-primary" onclick="order()">Order</button>
    </center>
  </div>
  


 <footer class="bg-dark text-center text-white">
<!-- Footer -->


  <!-- Footer Links -->
  <div class="container text-center text-md-left">

    <!-- Footer links -->
    <div class="row text-center text-md-left mt-3 pb-3">

      <!-- Grid column -->
      <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
        <h6 class="text-uppercase mb-4 font-weight-bold">Pizza Go!</h6>
        <p>Created by <br>
          1)Hitansh Doshi
          2)Aditya Dubey
          3)Shivam Dubey
          4)Shruti Dubey
          5)Sumeet Dubey

        </p>
      </div>
      <!-- Grid column -->

      <hr class="w-100 clearfix d-md-none">

      <!-- Grid column -->
      <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mt-3">
        <h6 class="text-uppercase mb-4 font-weight-bold">Products we offer</h6>
        <p>
          Pizza
        <p>
          Garlic Bread
        </p>
        <p>
          Beverage
        </p>
        <p>
          Desert
        </p>
      </div>
      <!-- Grid column -->

      <hr class="w-100 clearfix d-md-none">

      <!-- Grid column -->
      <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mt-3">
        <h6 class="text-uppercase mb-4 font-weight-bold">Links</h6>
        <p>
          Home Page
        </p>
        <p>
          Login
        </p>
        <p>
          Sing Up
        </p>
        <p>
          Help
        </p>
      </div>

      <!-- Grid column -->
      <hr class="w-100 clearfix d-md-none">

      <!-- Grid column -->
      <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mt-3">
        <h6 class="text-uppercase mb-4 font-weight-bold">Contact</h6>
        <p>
          <i class="fas fa-home mr-3"></i> 101, KamalaNagar, New Delhi, India</p>
        <p>
          <i class="fas fa-envelope mr-3"></i> email: info@gmail.com</p>
        <p>
          <i class="fas fa-phone mr-3"></i>  Telephone: 01 234 567 88</p>
        <p>
          <i class="fas fa-print mr-3"></i> Phone: + 01 234 567 89</p>
      </div>
      <!-- Grid column -->

    </div>
    <!-- Footer links -->

    <hr>

    <!-- Grid row -->
    <div class="row justify-content-center">

      <!-- Grid column -->
      <div class="col-md-6 col-lg-8">

        <!--Copyright-->
        <p class="text-center">Â© 2020 Copyright:
          
            <strong> Pizza Go!</strong>
          </a>
        </p>

      </div>
      <!-- Grid column -->

      <!-- Grid column -->
      <div class="col-md-5 col-lg-4 ml-lg-0">

        <!-- Social buttons -->
        <div class="text-center text-md-right">
          <ul class="list-unstyled list-inline">
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1">
                <i class="fab fa-facebook-f"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1">
                <i class="fab fa-twitter"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1">
                <i class="fab fa-google-plus-g"></i>
              </a>
            </li>
            <li class="list-inline-item">
              <a class="btn-floating btn-sm rgba-white-slight mx-1">
                <i class="fab fa-linkedin-in"></i>
              </a>
            </li>
          </ul>
        </div>

      </div>
      <!-- Grid column -->

    </div>
    <!-- Grid row -->

  </div>
  <!-- Footer Links -->



    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
      The above website is made for project purpose don't exepct any pizza delivery from us.
      Coded With &#10084;&#65039; and &#9749; while ðŸŽ“
    </div>

  </footer>

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
crossorigin="anonymous"></script>

<script>

  function rows(i, id, name, price){
    var row = `<tr id="item${i}">
          <th scope="row">${i + 1}</th>
          <td>${name}</td>
          <td>
          <span class="material-icons" onclick="toggle(${i})">
            assignment
          </span>
          <div id="ddes${i}" style="display:none;">
            <textarea id="des${i}"> </textarea>
          </div>
          </td>
          <td>
            <select class="form-control" id="qyt${i}" onchange="change_price(${i}, ${price})">
              <option>0</option>
              <option selected>1</option>
              <option>2</option>
              <option>3</option>
              <option>4</option>
              <option>5</option>
            </select>
          </td>
          <td>
            <span id="amt${i}"> ${price} </span>
          </td>

        </tr>`;

      return row;
  }

  function change_price(id, price) {
    var amt = document.getElementById("amt" + id);
    var qyt = document.getElementById("qyt" + id);

    amt.innerText = parseFloat(price * qyt.value);
  }

  function add_row(items){
    console.log(items);
    var table = document.getElementById("table_body");
    var data = "";
    for(var i=0;i<items.length;i++){
      console.log(items[i]['price']);
      data += rows(i, items[i]['id'], items[i]['name'], items[i]['price']);
    }
    table.innerHTML = data;
  }

  function toggle(id){
    var ddes = document.getElementById(`ddes${id}`);
    if(ddes.style.display == 'none')
      ddes.style.display = 'block';
    else
      ddes.style.display = 'none';
  }

    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          // Does this cookie string begin with the name we want?
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

  function order(){
    var order = [];
    for(var i=0;i<items.length;i++){
      var item = items[i]['name'];
      var des = document.getElementById(`des${i}`).value;
      var qyt = document.getElementById(`qyt${i}`).value;
      var price = document.getElementById(`amt${i}`).innerText;

      if(qyt == 0) continue;

      var data = {'id':items[i]['id'], 'type':items[i]['type'], 'item': item, 'qyt': qyt, 'des': des, 'price': price}

      order.push(data);
    }
    
    fetch('/order_done/', 
      {
      method: 'POST',
      credentials: "same-origin",
      headers: {
        "X-CSRFToken": getCookie("csrftoken"),
        "Accept": "application/json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        'address': document.getElementById('address').value,
        'order': order,
      }),
    })
    .then(res=>{
      console.log(res);
      if(res.status == 200){
        alert("Order Placed sucessfully");
        console.log("sucessful");
      }
      else{
        alert("Their is some error please retry");
        console.log("unsucessful");
      }
    })
    .then(sessionStorage.clear())
    .then(location.href= '/');
  }

  const items = JSON.parse(sessionStorage.getItem('order'));

  for(item in items){
    console.log(item);
  }
  add_row(items);

</script>

</html>